<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸš— Ultimate Vehicle Tracker</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    margin: 0;
    font-family: "Poppins", sans-serif;
    background: #0a0a0a;
    color: #fff;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  header {
    text-align: center;
    padding: 10px;
    background: linear-gradient(90deg, #2e3192, #1bffff);
    font-size: 1.3em;
    font-weight: bold;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  }

  #info {
    padding: 8px;
    background: #111;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
    text-align: center;
    font-size: 0.9em;
    border-bottom: 1px solid #222;
  }

  .value { color: #00ffcc; font-weight: bold; }

  #controls { padding: 8px; background: #111; border-bottom: 1px solid #222; display:flex; justify-content:center; align-items:center; }

  #map { flex: 1; width: 100%; }

  #speedChartContainer { background: #111; padding: 10px; border-top: 1px solid #222; }

  canvas { width: 100%; height: 180px; }

  label { font-size: 0.95em; margin-left: 6px; }

  .leaflet-control-attribution { display: none; }
</style>
</head>
<body>
<header>ðŸš— Ultimate Vehicle Tracker</header>

<div id="info">
  <div>Speed: <span id="speed" class="value">0</span> km/h</div>
  <div>Max: <span id="maxSpeed" class="value">0</span> km/h</div>
  <div>Avg: <span id="avgSpeed" class="value">0</span> km/h</div>
  <div>Distance: <span id="distance" class="value">0</span> km</div>
  <div>Time: <span id="timeElapsed" class="value">00:00:00</span></div>
  <div>Lat: <span id="lat" class="value">--</span></div>
  <div>Lng: <span id="lng" class="value">--</span></div>
</div>

<div id="controls">
  <input type="checkbox" id="autoCenter" checked>
  <label for="autoCenter">Auto Center Map</label>
</div>

<div id="map"></div>

<div id="speedChartContainer">
  <canvas id="speedChart"></canvas>
</div>

<!-- Alert Sound -->
<audio id="alertSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  // Map setup
  let map = L.map('map').setView([23.8103, 90.4125], 15);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

  // Custom Car Icon
  let carIcon = L.icon({
    iconUrl: 'https://i.postimg.cc/3xn9Sd08/car.png', // Replace with realistic car icon URL if needed
    iconSize: [50, 50],
    iconAnchor: [25, 25]
  });

  let marker = L.marker([23.8103, 90.4125], {icon: carIcon}).addTo(map);
  let pathCoords = [];
  let polyline = L.polyline(pathCoords, {color: '#00ffcc', weight: 5}).addTo(map);

  // Tracking data
  let lastLatLng = null;
  let autoCenter = true;
  let alertPlaying = false;
  let speedLimit = 60;
  let speedSamples = [];
  let totalDistance = 0;
  let maxSpeed = 0;
  let startTime = Date.now();

  document.getElementById("autoCenter").addEventListener("change", (e) => autoCenter = e.target.checked);

  // Chart.js setup
  const ctx = document.getElementById('speedChart').getContext('2d');
  const speedChart = new Chart(ctx, {
    type: 'line',
    data: { labels: [], datasets: [{ label: 'Speed (km/h)', data: [], borderColor: '#00ffcc', backgroundColor: 'rgba(0,255,200,0.1)', tension:0.3 }] },
    options: { responsive:true, plugins:{legend:{labels:{color:'#fff'}}}, scales:{x:{ticks:{color:'#aaa'}},y:{ticks:{color:'#aaa'},beginAtZero:true}} }
  });

  // Live tracking
  if (navigator.geolocation) {
    navigator.geolocation.watchPosition(updatePosition, showError, { enableHighAccuracy:true, maximumAge:0, timeout:10000 });
  } else { alert("GPS not supported."); }

  function updatePosition(pos) {
    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;
    const speed = (pos.coords.speed || 0)*3.6; // km/h
    const timestamp = new Date().toLocaleTimeString();

    // Update info text
    document.getElementById('lat').textContent = lat.toFixed(5);
    document.getElementById('lng').textContent = lng.toFixed(5);
    document.getElementById('speed').textContent = speed.toFixed(1);

    // Update Max & Avg
    speedSamples.push(speed);
    maxSpeed = Math.max(maxSpeed, speed);
    let avgSpeed = speedSamples.reduce((a,b)=>a+b,0)/speedSamples.length;
    document.getElementById('maxSpeed').textContent = maxSpeed.toFixed(1);
    document.getElementById('avgSpeed').textContent = avgSpeed.toFixed(1);

    // Distance
    const newLatLng = L.latLng(lat, lng);
    if(lastLatLng) totalDistance += lastLatLng.distanceTo(newLatLng)/1000; // km
    document.getElementById('distance').textContent = totalDistance.toFixed(3);

    // Tracking time
    let elapsedMs = Date.now()-startTime;
    document.getElementById('timeElapsed').textContent = msToTime(elapsedMs);

    // Update marker & trail
    pathCoords.push(newLatLng);
    polyline.setLatLngs(pathCoords);

    if(lastLatLng){
      const bearing = getBearing(lastLatLng.lat, lastLatLng.lng, lat, lng);
      marker._icon.style.transform = `rotate(${bearing}deg)`;
    }
    marker.setLatLng(newLatLng);
    if(autoCenter) map.panTo(newLatLng, {animate:true, duration:0.5});

    lastLatLng = newLatLng;

    // Speed alert
    const sound = document.getElementById("alertSound");
    if(speed > speedLimit && !alertPlaying){ alertPlaying=true; sound.play(); }
    else if(speed <= speedLimit && alertPlaying){ alertPlaying=false; sound.pause(); sound.currentTime=0; }

    // Update chart
    speedChart.data.labels.push(timestamp);
    speedChart.data.datasets[0].data.push(speed.toFixed(1));
    if(speedChart.data.labels.length > 20){
      speedChart.data.labels.shift();
      speedChart.data.datasets[0].data.shift();
    }
    speedChart.update();
  }

  function msToTime(ms){
    const s = Math.floor(ms/1000)%60, m = Math.floor(ms/60000)%60, h = Math.floor(ms/3600000);
    return String(h).padStart(2,'0')+':'+String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
  }

  function showError(e){
    switch(e.code){
      case e.PERMISSION_DENIED: alert("Location permission denied"); break;
      case e.POSITION_UNAVAILABLE: alert("Location unavailable"); break;
      case e.TIMEOUT: alert("Location request timed out"); break;
      default: alert("Unknown error");
    }
  }

  function getBearing(lat1, lon1, lat2, lon2){
    const Ï†1 = lat1*Math.PI/180, Ï†2 = lat2*Math.PI/180, Î”Î» = (lon2-lon1)*Math.PI/180;
    const y = Math.sin(Î”Î»)*Math.cos(Ï†2);
    const x = Math.cos(Ï†1)*Math.sin(Ï†2) - Math.sin(Ï†1)*Math.cos(Ï†2)*Math.cos(Î”Î»);
    const Î¸ = Math.atan2(y,x);
    return (Î¸*180/Math.PI + 360)%360;
  }
</script>
</body>
</html>

